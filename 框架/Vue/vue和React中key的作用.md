                    Vue和React中的key作用
> key是给每个vnode的唯一id,依靠key,我们的diff操作可以更准确、更快速。对于简单列表页渲染来说diff节点也更快,但会产生一些隐藏的副作用,比如可能不会产生过渡效果,或者在某些节点有绑定数据(表单)状态,会出现状态错位.
> diff算法的的过程,先回进行新旧节点的首尾交叉对比,当无法匹配的时候会用新节点的key与旧节点进行比对，从而找到相应旧节点。
                        
                    为什么更准确？
> 因为带key就不是就地复用，在sameNode函数a.key === b.key对比中可以避免就地复用的情况，所以会更加准确，如果不加key会导致之前的节点状态被保留下来，会产生一系列的bug。

                    为什么更快?
> key的唯一性可以被Map数据结构充分利用，相比于遍历查找的时间复杂度O(n),Map的时间复杂度仅仅为O(1).

                    为什么Map数据结构会更快?
> Map/Set/WeakSet/WeakMap就是使用隐藏的Hash code优化哈希表  
 
###哈希码Hash code
散列函数用于给特定的key映射哈希表中的特定位置，一个哈希码就是给定的key运行此散列函数的运算结果。
在V8中,哈希码是一个随机数，与对象值无关，因此我们无法重新计算它，这意味着我们必须存储它。
以前，对于那些把js对象作为key的情况，V8将哈希码作为私有符号存储在对象上，V8中的私有符号类似于Symbol，只是它不可枚举，也不会泄露到用户空间js中。也就是说这个symbol只在V8引擎内部使用，用户的js代码访问不到。
```ecmascript 6
function GetObjectHash(key) {
  let hash = key[hashCodeSymbol];
  if (IS_UNDEFINED(hash)) {
   hash = (MathRondom() * 0x400000000) | 0;
  if ( hash === 0 ) 
      hash = 1;
      key[hashCodeSymbol] = hash;
  }
  return hash;
}
```              
之所以行之有效，是因为在将对象添加到哈希表之前，我们不会为哈希码字段保留内存，当对象被添加到哈希表时，才把新的私有符号存储在对象上。

与使用内联缓存系统进行的任何其它属性查找一样，V8还可以优化哈希码符号查找，从而为哈希提供非常快的查找。当键具有相同的隐藏类型时，对于单态内联缓存查找非常有效，但是，大多数现实世界的代码都不遵循这种模式，并且键通常具有不同的隐藏类，导致散列码的复态内联缓存查找变慢。
私有符号方法的另一个问题是它在存储散列码key时触发了一个隐藏的类转换，这导致不仅对哈希码查找变慢，而且在对象上存储的其它key的查找也会进行deoptimization操作(把已经优化的代码重新去除优化)

### JS对象支持存储
V8的js对象(JSObject)使用2个word(除了它的头部),一个word用于存储指向元素存储的指针，另一个word用于存储指向属性存储的指针。
元素存储用于像数组索引的属性，而属性存储用于其键为字符串或符号的属性。

### 隐藏哈希码
存储哈希码最简单的方法是将js对象大小扩展一个字，并将散列码直接存储在对象上，但是，对于那些没有添加到哈希表中的对象，这会浪费内存，相反，我们尝试将散列码存储在元素存储或属性存储中。
元素存储是一个包含其长度和所有元素的数组，在这里没有太多的工作要做，因为可以把哈希吗存储在一个保留的槽中，不过，当我们不使用这个对象作为哈希表中的关键字时，仍然会浪费内存。

属性存储，有两种数据结构用作属性存储： 数组和字典
与元素存储中使用的数组不同，元素存储不具有上限。而属性存储中使用的数组的上限为1022个值，由于性能原因，v8在 超过此限制时则转换为使用字典模式，
因此属性存储有三种可能的状态
空,(没有属性)数组(最多可以存储1022个值),字典
1。属性存储是空的
对于空的情况，我们可以直接在JSObject的偏移量上存储哈希码。
2。属性存储是一个数组
V8表示小于2的31次方的整数更加高效。
3。属性支持存储是一个字典
对于字典的情况，我们将字典大小增加一个字节，以便将哈希码存储在字典起始位置的专用槽中，在这种情况下，我们可能会浪费掉一个字的存储空间，因为这个比例增长大小并不像数组那么大。通过这些查找，哈希码不再需要经过复杂的js属性查找机制。

































